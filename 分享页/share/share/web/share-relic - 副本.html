<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="images/icon-80.png" rel="shortcut icon">
    <title>赛导游</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="stylesheet" href="css/style.css" type="text/css">
	<link rel="stylesheet" href="player/css/stylesheets/style.css">
	<script src="player/js/jquery-1.7.2.min.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?40e889c72eadd835b33c57d9a84a6ed9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body>
	<!--<header>
		<div class="back "><div class="fonts">返回</div></div>
		<div class="title borderBottom">陕西历史博物馆</div>
	</header>-->
	<section>
		<div class="cultural-relic">
			<img src="images/bg.png" width="100%" height="180px;"/>
			<div>
				<p class="cultural-title">试听：文物名称</p>
			</div>
		</div>
		<div class="btn-cont">
			<!--<audio src="music/郑源 - 为爱停留.mp3" controls="controls"></audio>-->
			
			<!--  音频部分-->
				<div id="player">
					<div class="ctrl">
						<div class="control">
							<div class="left">
								<div class="playback icon"></div>
							</div>
							<div class="volume right">
								<div class="mute icon left"></div>
								<div class="slider left">
									<div class="pace"></div>
								</div>
							</div>
						</div>
						<div class="progress">
							<div class="slider">
								<div class="loaded"></div>
								<div class="pace"></div>
							</div>
							<div class="timer left">0:00</div>
							<div class="right">
								<div class="endtime" id="endtime">0:00</div>
							</div>
						</div>
					</div>
				</div>
				<!--音频名称 -->
				<input type="hidden" id="audioplayer" value="http://cdn.saidaoyou.com/a976d1b924a74bfb9489f72cf9f0475d"/>
			<!--音频部分结束-->
			
			
			
			<button class="btn" type="button">打开APP,不止是试听</button>
		</div>
		<div class="navigation">
			<div class="navigation-title">地图导览</div>
		</div>
		<div class="navigation-cont">
			<div class="bgimg" style="width:100%;">
				<div class="bgimg_top">
					<p>试听音频文物名称</p>
				</div>
				<div class="container">
					<div class="cir"></div>  
					<div class="pulse"></div>
				</div>
				<div class="cp"><p>导览地图，边看边听，景区精彩全知道</p></div>
			</div>
		</div>
		<div class="navigation">
			<div class="navigation-title">更多精彩</div>
		</div>
		
		<div class="navigation-list">
			<div class="navigation-ms">
				<div class="zj">
					<div class="dleft"><p class="p1">文物名称</p>	</div>
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp1.png" />
				<div class="zj1">
					<div class="dleft"><p class="p1">文物名称</p></div>	
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp2.png" />
				<div class="zj2">
					<div class="dleft"><p class="p1">文物名称</p>	</div>
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp3.png" />
			</div>
			<div class="navigation-ms">
				<div class="zj">
					<div class="dleft"><p class="p1">文物名称</p></div>	
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp1.png" />
				<div class="zj1">
					<div class="dleft"><p class="p1">文物名称</p>	</div>
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp2.png" />
				<div class="zj2">
					<div class="dleft"><p class="p1">文物名称</p>	</div>
					<div class="dright"><img src="images/播放标志@2x.png" /></div>
				</div>							
				<img src="images/cp3.png" />
			</div>
		</div>
		
		
       <div class="row bgcol-hr" style="height: 10px;"></div>
		 <div class="bgcol-footer">
			<a href="#">更多...</a>
		</div>
		<div class="row bgcol-float col-white">
			<div class="logo">
			<img src="images/logo.png" />
			<span style="position:absolute;margin-left:5px;margin-top:14px;font-size:20px;color:#fff;">赛导游</span>
			<span style="position:absolute;margin-left:5px;margin-top:46px;font-size:15px;color:#eee;">听讲解，就用赛导游</span>
			<button class="float-btn" type="button">打开APP</button>
			</div>
			<!--<div class="col-xs-12" style="text-align: center;padding:12px 0">  Copyright © 2013-2015 Touchmedia Inc.</div>
			<img src="images/logo.png" />-->
	    </div>
		<div style="width:100%;height:80px;"></div>
    </div>
	</section>

<script src="player/js/jquery-ui-1.8.17.custom.min.js"></script>
<!--<script src="player/js/script.js"></script>-->
<script>
	(function($){
		// Settings
		var audioplayer=$("#audioplayer").val();
		var repeat = localStorage.repeat || 0,
			shuffle = localStorage.shuffle || 'false',
			continous = true,
			autoplay = true,//是否直接播放
			playlist = [
				{
				title: '德国第一装甲师进行曲',
				artist: '德国',
				album: '德国第一装甲师进行曲.mp3',
				cover:'player/img/1.jpg',
				mp3: audioplayer,/*'player/mp3/deguo.mp3'*/
				ogg: ''
				}
				/*{
				title: '亡灵序曲',
				artist: '魔兽世界',
				album: '魔兽世界 - 亡灵序曲.mp3',
				cover: 'player/img/2.jpg',
				mp3: 'player/mp3/The Dawn.mp3',
				ogg: ''
				},
				{
				title: 'chenparty dj.mp3',
				artist: '德国童声',
				album: 'chenparty 超好听的德国童声 dj.mp3',
				cover: 'player/img/3.jpg',
				mp3: 'player/mp3/chenparty dj.mp3',
				ogg: ''
				},*/
			];
			
		// Load playlist
		for (var i=0; i<playlist.length; i++){
			var item = playlist[i];
			$('#playlist').append('<li>'+item.artist+' - '+item.title+'</li>');
		}

		var time = new Date(),
			currentTrack = shuffle === 'true' ? time.getTime() % playlist.length : 0,
			trigger = false,
			audio, timeout, isPlaying, playCounts;
		
		//音频播放
		var play = function(){
			audio.play();
			$('.playback').addClass('playing');
			timeout = setInterval(updateProgress, 500);
			isPlaying = true;
		}
		
		//暂停
		var pause = function(){
			audio.pause();
			$('.playback').removeClass('playing');
			clearInterval(updateProgress);
			isPlaying = false;
		}

		// Update progress
		var setProgress = function(value){
			var currentSec = parseInt(value%60) < 10 ? '0' + parseInt(value%60) : parseInt(value%60),
				ratio = value / audio.duration * 100;

			$('.timer').html(parseInt(value/60)+':'+currentSec);
			$('.progress .pace').css('width', ratio + '%');
			$('.progress .slider a').css('left', ratio + '%');
		}

		var updateProgress = function(){
			setProgress(audio.currentTime);
		}

		// Progress slider
		$('.progress .slider').slider({step: 0.1, slide: function(event, ui){
			$(this).addClass('enable');
			setProgress(audio.duration * ui.value / 100);
			clearInterval(timeout);
		}, stop: function(event, ui){
			audio.currentTime = audio.duration * ui.value / 100;
			$(this).removeClass('enable');
			timeout = setInterval(updateProgress, 500);
		}});

		// Volume slider
		var setVolume = function(value){
			audio.volume = localStorage.volume = value;
			$('.volume .pace').css('width', value * 100 + '%');
			$('.volume .slider a').css('left', value * 100 + '%');
		}

		var volume = localStorage.volume || 0.5;
		$('.volume .slider').slider({max: 1, min: 0, step: 0.01, value: volume, slide: function(event, ui){
			setVolume(ui.value);
			$(this).addClass('enable');
			$('.mute').removeClass('enable');
		}, stop: function(){
			$(this).removeClass('enable');
		}}).children('.pace').css('width', volume * 100 + '%');

		$('.mute').click(function(){
			if ($(this).hasClass('enable')){
				setVolume($(this).data('volume'));
				$(this).removeClass('enable');
			} else {
				$(this).data('volume', audio.volume).addClass('enable');
				setVolume(0);
			}
		});

		// Switch track
		var switchTrack = function(i){
			if (i < 0){
				track = currentTrack = playlist.length - 1;
			} else if (i > playlist.length){
				track = currentTrack = 0;
			} else {
				track = i;
			}
			$('audio').remove();
			loadMusic(track);
			if (isPlaying == true) play();
			
		}

		// Shuffle 拖曳
		var shufflePlay = function(){
			var time = new Date(),
				lastTrack = currentTrack;
			currentTrack = time.getTime() % playlist.length;
			if (lastTrack == currentTrack) ++currentTrack;
			switchTrack(currentTrack);
		}

		// Fire when track ended
		var ended = function(){
			pause();
			audio.currentTime = 0;
			playCounts++;
			if (continous == true) isPlaying = true;
			if (repeat == 1){
				play();
			} else {
				if (shuffle === 'true'){
					shufflePlay();
				} else {
					if (repeat == 2){
						switchTrack(++currentTrack);
					} else {
						if (currentTrack < playlist.length) switchTrack(++currentTrack);
					}
				}
			}
		}

		var beforeLoad = function(){
			var endVal = this.seekable && this.seekable.length ? this.seekable.end(0) : 0;
			$('.progress .loaded').css('width', (100 / (this.duration || 1) * endVal) +'%');
		}
	
		// Fire when track loaded completely  加载完成 play(); pause();
		var afterLoad = function(){
			$("#endtime").html(parseInt(this.duration));
			if (autoplay == true) play();
		}

		// Load track
		var loadMusic = function(i){
			var item = playlist[i],
				newaudio = $('<audio>').html('<source src="'+item.mp3+'"><source src="'+item.ogg+'">').appendTo('#player');
			
			$('.cover').html('<img src="'+item.cover+'" alt="'+item.album+'">');
			$('.tag').html('<strong>'+item.title+'</strong><span class="artist">'+item.artist+'</span><span class="album">'+item.album+'</span>');
			$('#playlist li').removeClass('playing').eq(i).addClass('playing');
			audio = newaudio[0];
			audio.volume = $('.mute').hasClass('enable') ? 0 : volume;
			audio.addEventListener('progress', beforeLoad, false);
			audio.addEventListener('durationchange', beforeLoad, false);
			audio.addEventListener('canplay', afterLoad, false);
			audio.addEventListener('ended', ended, false);
		}

		loadMusic(currentTrack);
		$('.playback').on('click', function(){
			if ($(this).hasClass('playing')){
				pause();
			} else {
				play();
			}
		});
		$('.rewind').on('click', function(){
			if (shuffle === 'true'){
				shufflePlay();
			} else {
				switchTrack(--currentTrack);
			}
		});
		$('.fastforward').on('click', function(){
			if (shuffle === 'true'){
				shufflePlay();
			} else {
				switchTrack(++currentTrack);
			}
		});
		$('#playlist li').each(function(i){
			var _i = i;
			$(this).on('click', function(){
				switchTrack(_i);
			});
		});

		if (shuffle === 'true') $('.shuffle').addClass('enable');
		if (repeat == 1){
			$('.repeat').addClass('once');
		} else if (repeat == 2){
			$('.repeat').addClass('all');
		}

		$('.repeat').on('click', function(){
			if ($(this).hasClass('once')){
				repeat = localStorage.repeat = 2;
				$(this).removeClass('once').addClass('all');
			} else if ($(this).hasClass('all')){
				repeat = localStorage.repeat = 0;
				$(this).removeClass('all');
			} else {
				repeat = localStorage.repeat = 1;
				$(this).addClass('once');
			}
		});

		$('.shuffle').on('click', function(){
			if ($(this).hasClass('enable')){
				shuffle = localStorage.shuffle = 'false';
				$(this).removeClass('enable');
			} else {
				shuffle = localStorage.shuffle = 'true';
				$(this).addClass('enable');
			}
		});
	})(jQuery);
</script>
</body>
</html>